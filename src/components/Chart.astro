---
export interface Props {
  data: any;
  type: "bar" | "line" | "doughnut" | "pie";
  title: string;
  id: string;
}

const { data, type, title, id } = Astro.props;
---

<div class="chart-card">
  <div class="chart-header">
    <h3 class="chart-title">
      <div class="chart-icon">
        <i class="fas fa-chart-bar"></i>
      </div>
      {title}
    </h3>
  </div>
  <div class="chart-body">
    <div class="chart-container">
      <canvas id={id}></canvas>
    </div>
  </div>
</div>

<script define:vars={{ data, type, id }}>
  document.addEventListener("DOMContentLoaded", function () {
    const ctx = document.getElementById(id).getContext("2d");

    new Chart(ctx, {
      type: type,
      data: data,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "top",
          },
          tooltip: {
            mode: "index",
            intersect: false,
          },
        },
        scales:
          type === "doughnut" || type === "pie"
            ? {}
            : {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: "rgba(0, 0, 0, 0.1)",
                  },
                },
                x: {
                  grid: {
                    color: "rgba(0, 0, 0, 0.1)",
                  },
                },
              },
        elements: {
          line: {
            tension: 0.4,
          },
        },
      },
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .chart-card {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: var(--transition-base);
  }

  .chart-card:hover {
    box-shadow: var(--shadow-md);
  }

  .chart-header {
    padding: var(--spacing-6);
    border-bottom: 1px solid var(--color-border);
    background: var(--color-gray-50);
  }

  .chart-title {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-gray-900);
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
  }

  .chart-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background: var(--color-gray-100);
    border-radius: var(--radius-md);
    color: var(--color-gray-600);
  }

  .chart-body {
    padding: var(--spacing-6);
  }

  .chart-container {
    position: relative;
    height: 300px;
    width: 100%;
  }

  @media (max-width: 768px) {
    .chart-container {
      height: 250px;
    }

    .chart-header {
      padding: var(--spacing-4);
    }

    .chart-body {
      padding: var(--spacing-4);
    }

    .chart-title {
      font-size: var(--text-base);
    }
  }
</style>
