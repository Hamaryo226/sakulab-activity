---
import type { RepositoryStats } from "../utils/github";

export interface Props {
  repositories: RepositoryStats[];
}

const { repositories } = Astro.props;
---

<div class="repository-table-card">
  <div class="table-header">
    <h3 class="table-title">
      <div class="table-icon">
        <i class="fas fa-code-branch"></i>
      </div>
      リポジトリ詳細
    </h3>
  </div>
  <div class="table-body">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>リポジトリ名</th>
            <th>言語</th>
            <th>コミット数</th>
            <th>コントリビューター</th>
            <th>スター</th>
            <th>フォーク</th>
            <th>最終更新</th>
            <th>アクティブ状態</th>
          </tr>
        </thead>
        <tbody>
          {
            repositories.map((repo) => (
              <tr>
                <td>
                  <div class="repo-name">
                    <i class="fas fa-folder" />
                    {repo.name}
                  </div>
                </td>
                <td>
                  <span class={`language-tag ${repo.language.toLowerCase()}`}>
                    {repo.language}
                  </span>
                </td>
                <td class="number-cell">{repo.commits.toLocaleString()}</td>
                <td class="number-cell">{repo.contributors}</td>
                <td class="number-cell">
                  <i class="fas fa-star" />
                  {repo.stars}
                </td>
                <td class="number-cell">
                  <i class="fas fa-code-branch" />
                  {repo.forks}
                </td>
                <td class="date-cell">
                  {new Date(repo.lastCommit).toLocaleDateString("ja-JP")}
                </td>
                <td>
                  <span
                    class={`status-badge ${repo.isActive ? "active" : "inactive"}`}
                  >
                    <i
                      class={`fas ${repo.isActive ? "fa-check-circle" : "fa-clock"}`}
                    />
                    {repo.isActive ? "アクティブ" : "非アクティブ"}
                  </span>
                </td>
              </tr>
            ))
          }
        </tbody>
      </table>

      {/* モバイル用カード表示 */}
      <div class="mobile-cards">
        {
          repositories.map((repo) => (
            <div class="mobile-card">
              <div class="mobile-card-header">
                <i class="fas fa-folder" />
                <div class="mobile-card-title">{repo.name}</div>
                <span class={`language-tag ${repo.language.toLowerCase()}`}>
                  {repo.language}
                </span>
              </div>
              <div class="mobile-card-body">
                <div class="mobile-card-item">
                  <div class="mobile-card-label">コミット数</div>
                  <div class="mobile-card-value">
                    {repo.commits.toLocaleString()}
                  </div>
                </div>
                <div class="mobile-card-item">
                  <div class="mobile-card-label">コントリビューター</div>
                  <div class="mobile-card-value">{repo.contributors}</div>
                </div>
                <div class="mobile-card-item">
                  <div class="mobile-card-label">スター</div>
                  <div class="mobile-card-value">
                    <i class="fas fa-star" />
                    {repo.stars}
                  </div>
                </div>
                <div class="mobile-card-item">
                  <div class="mobile-card-label">フォーク</div>
                  <div class="mobile-card-value">
                    <i class="fas fa-code-branch" />
                    {repo.forks}
                  </div>
                </div>
                <div class="mobile-card-item full-width">
                  <div class="mobile-card-label">最終更新</div>
                  <div class="mobile-card-value">
                    {new Date(repo.lastCommit).toLocaleDateString("ja-JP")}
                  </div>
                </div>
              </div>
              <div class="mobile-status">
                <span
                  class={`status-badge ${repo.isActive ? "active" : "inactive"}`}
                >
                  <i
                    class={`fas ${repo.isActive ? "fa-check-circle" : "fa-clock"}`}
                  />
                  {repo.isActive ? "アクティブ" : "非アクティブ"}
                </span>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</div>

<style>
  .repository-table-card {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: var(--transition-base);
  }

  .repository-table-card:hover {
    box-shadow: var(--shadow-md);
  }

  .table-header {
    padding: var(--spacing-6);
    border-bottom: 1px solid var(--color-border);
    background: var(--color-gray-50);
  }

  .table-title {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-gray-900);
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
  }

  .table-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background: var(--color-gray-100);
    border-radius: var(--radius-md);
    color: var(--color-gray-600);
  }

  .table-body {
    padding: var(--spacing-6);
  }

  .table-container {
    overflow-x: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
  }

  .data-table th,
  .data-table td {
    padding: var(--spacing-4);
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .data-table th {
    background: var(--color-gray-50);
    font-weight: var(--font-semibold);
    color: var(--color-gray-700);
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .data-table tbody tr {
    transition: var(--transition-base);
  }

  .data-table tbody tr:hover {
    background: var(--color-gray-50);
  }

  .data-table tbody tr:last-child td {
    border-bottom: none;
  }

  .repo-name {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-weight: var(--font-medium);
    color: var(--color-gray-900);
  }

  .repo-name i {
    color: var(--color-gray-500);
  }

  .language-tag {
    display: inline-block;
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    background: var(--color-gray-100);
    color: var(--color-gray-700);
    border: 1px solid var(--color-gray-200);
  }

  .number-cell {
    text-align: right;
    font-weight: var(--font-medium);
    color: var(--color-gray-900);
  }

  .number-cell i {
    color: var(--color-gray-500);
    margin-right: var(--spacing-1);
  }

  .date-cell {
    color: var(--color-gray-600);
    font-size: var(--text-xs);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
  }

  .status-badge.active {
    background: var(--color-gray-100);
    color: var(--color-gray-700);
    border: 1px solid var(--color-gray-200);
  }
  .status-badge.inactive {
    background: var(--color-gray-50);
    color: var(--color-gray-500);
    border: 1px solid var(--color-gray-200);
  }

  /* デスクトップではモバイルカードを非表示 */
  .mobile-cards {
    display: none;
  }
  /* タブレット表示の調整 */
  @media (max-width: 1024px) {
    .data-table th,
    .data-table td {
      padding: var(--spacing-3);
      font-size: var(--text-xs);
    }

    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .data-table {
      min-width: 800px;
    }
  }

  /* モバイル表示：カード形式に変更 */
  @media (max-width: 768px) {
    .table-header {
      padding: var(--spacing-4);
    }

    .table-body {
      padding: var(--spacing-4);
    }

    .table-title {
      font-size: var(--text-base);
    }

    .table-container {
      overflow: visible;
      border: none;
    }

    .data-table {
      display: none;
    }

    .mobile-cards {
      display: block;
      gap: var(--spacing-4);
    }

    .mobile-card {
      background: white;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-4);
      margin-bottom: var(--spacing-3);
      box-shadow: var(--shadow-sm);
    }

    .mobile-card-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      margin-bottom: var(--spacing-3);
      padding-bottom: var(--spacing-2);
      border-bottom: 1px solid var(--color-border);
    }

    .mobile-card-title {
      font-weight: var(--font-semibold);
      color: var(--color-gray-900);
      flex: 1;
    }

    .mobile-card-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-3);
    }

    .mobile-card-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-1);
    }

    .mobile-card-label {
      font-size: var(--text-xs);
      font-weight: var(--font-medium);
      color: var(--color-gray-500);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .mobile-card-value {
      font-size: var(--text-sm);
      color: var(--color-gray-900);
    }

    .mobile-card-item.full-width {
      grid-column: 1 / -1;
    }

    .mobile-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--spacing-2);
      padding-top: var(--spacing-2);
      border-top: 1px solid var(--color-border);
    }
  }

  /* 小さなモバイル端末での調整 */
  @media (max-width: 480px) {
    .mobile-card-body {
      grid-template-columns: 1fr;
    }

    .table-header {
      padding: var(--spacing-3);
    }

    .table-body {
      padding: var(--spacing-3);
    }

    .mobile-card {
      padding: var(--spacing-3);
    }
  }
</style>
